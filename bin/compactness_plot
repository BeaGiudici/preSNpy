#!/usr/bin/env python3

########################################################################
#
# Compute the comapctness for every postbounce model
#
########################################################################

import os
from preSNpy.model import Postbounce1D, PreSN1D
from folders import POSTDIR, PLOTSDIR
import matplotlib.pyplot as plt
import argparse

parser = argparse.ArgumentParser()
parser.add_argument('--dir', default=POSTDIR, type=str, \
                    help='Directory where the models are')
parser.add_argument('-M', '-m', type=float, default=2.5, \
                    help='Parameter for the compactness')
parser.add_argument('--xlim', nargs='+', default=[12,30], \
                    help='Limits for the x-axis')
parser.add_argument('--source', default='kepler', \
                    help='Source for the PreSN1D')
args = parser.parse_args()
M0 = args.M

fig, ax = plt.subplots()
ax.set_xlabel(r'$M_\mathrm{ZAMS}$ [$M_{\odot}$]')
ax.set_ylabel(r'$\xi_{2.5}$')
ax.set_xlim(args.xlim)
ax.set_ylim([1e-3, 0.49])

for file in os.listdir(args.dir):
  if '.py' in file:
    continue
  path = os.path.join(args.dir, file)
  print(path)
  try:
    m = Postbounce1D(path)
  except:
    m = PreSN1D(path, source = args.source)
  xi = m.compactness(masslim=M0)
  Mzams = m.ZAMS_mass()
  plt.plot(Mzams.value, xi.value, ls='', marker='o', color='red')

fig.savefig(os.path.join(PLOTSDIR, 'compactness.pdf'), bbox_inches='tight')
